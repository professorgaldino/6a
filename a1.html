<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boletim Escolar</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
      text-align: center;
    }
    header {
      background-color: white;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }
    .logo {
      width: 120px;
      height: auto;
    }
    .foto-aluno {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 5px solid #2259f2;
    }
    .nome-aluno {
      font-size: 24px;
      font-weight: 600;
      margin-top: 10px;
      color: #2259f2;
    }
    .container {
      width: 90%;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #2259f2;
      color: white;
    }
    .paginacao {
      margin: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .paginacao button {
      padding: 8px 12px;
      border: 1px solid #2259f2;
      border-radius: 8px;
      background: white;
      color: #2259f2;
      font-weight: bold;
      cursor: pointer;
    }
    .paginacao button.ativo {
      background: #2259f2;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <img src="logoescola.jpeg" alt="Logo da Escola" class="logo">
    <img id="fotoAluno" src="" alt="Foto do Aluno" class="foto-aluno">
  </header>

  <h1 class="nome-aluno">Carregando nome...</h1>

  <div class="paginacao" id="paginacao"></div>

  <div class="container">
    <h2>Desempenho Bimestral</h2>
    <table id="boletim"></table>
  </div>

  <div class="container">
    <h2>Ocorrências</h2>
    <table>
      <tr><th>Data</th><th>Descrição</th></tr>
      <tr><td></td><td></td></tr>
      <tr><td></td><td></td></tr>
      <tr><td></td><td></td></tr>
    </table>
  </div>

  <script>
    let alunos = {};
    let bimestres = ["dados1.json", "dados2.json", "dados3.json", "dados4.json"];
    let dadosBimestrais = [];
    let alunoIdAtual = "1";

    async function carregarTodosOsDados() {
      try {
        // Carrega dados dos bimestres
        dadosBimestrais = await Promise.all(bimestres.map(async (arquivo) => {
          const resp = await fetch(arquivo);
          if (!resp.ok) throw new Error(`Erro ao carregar ${arquivo}`);
          return await resp.json();
        }));

        // Carrega alunos.json
        const respAlunos = await fetch("alunos.json");
        if (!respAlunos.ok) throw new Error("Erro ao carregar alunos.json");
        alunos = await respAlunos.json();

        criarBotoesPaginacao();
        exibirAluno(alunoIdAtual);
      } catch (e) {
        console.error("Erro ao carregar dados:", e);
      }
    }

    function criarBotoesPaginacao() {
      const paginacao = document.getElementById("paginacao");
      paginacao.innerHTML = "";

      for (let id in alunos) {
        const btn = document.createElement("button");
        btn.textContent = id;
        btn.classList.toggle("ativo", id === alunoIdAtual);
        btn.onclick = () => {
          alunoIdAtual = id;
          atualizarBotoes();
          exibirAluno(id);
        };
        paginacao.appendChild(btn);
      }
    }

    function atualizarBotoes() {
      const botoes = document.querySelectorAll(".paginacao button");
      botoes.forEach(btn => {
        btn.classList.toggle("ativo", btn.textContent === alunoIdAtual);
      });
    }

    function exibirAluno(id) {
      carregarBoletim(agruparDadosPorDisciplina(id));
      carregarDadosAluno(id);
    }

    function agruparDadosPorDisciplina(id) {
      const disciplinas = {};

      for (let bimestre = 0; bimestre < dadosBimestrais.length; bimestre++) {
        const dados = dadosBimestrais[bimestre][id];
        if (!dados) continue;

        for (let materia in dados) {
          if (!disciplinas[materia]) {
            disciplinas[materia] = {
              notas: ["-", "-", "-", "-"],
              faltas: ["-", "-", "-", "-"],
              faltas_acumuladas: ["-", "-", "-", "-"]
            };
          }

          disciplinas[materia].notas[bimestre] = dados[materia].notas[0] ?? "-";
          disciplinas[materia].faltas[bimestre] = dados[materia].faltas[0] ?? "-";
          disciplinas[materia].faltas_acumuladas[bimestre] = dados[materia].faltas_acumuladas ?? "-";
        }
      }

      return disciplinas;
    }

    function carregarBoletim(jsonData) {
      let boletim = document.getElementById("boletim");
      let tabelaHTML = `<tr>
        <th>Disciplina</th>
        <th>1º Bim - Nota</th><th>1º Bim - Faltas</th><th>1º Bim - Acum.</th>
        <th>2º Bim - Nota</th><th>2º Bim - Faltas</th><th>2º Bim - Acum.</th>
        <th>3º Bim - Nota</th><th>3º Bim - Faltas</th><th>3º Bim - Acum.</th>
        <th>4º Bim - Nota</th><th>4º Bim - Faltas</th><th>4º Bim - Acum.</th>
      </tr>`;

      for (let disciplina in jsonData) {
        const d = jsonData[disciplina];
        tabelaHTML += `<tr>
          <td>${disciplina}</td>
          ${[0,1,2,3].map(i => `
            <td class="nota">${d.notas[i]}</td>
            <td>${d.faltas[i]}</td>
            <td>${d.faltas_acumuladas[i]}</td>
          `).join('')}
        </tr>`;
      }

      boletim.innerHTML = tabelaHTML;

      const notas = boletim.querySelectorAll("td.nota");
      notas.forEach(celula => {
        const valor = celula.textContent.trim();
        if (valor === "-") {
          celula.style.backgroundColor = "#e0d4f7";
        } else if (!isNaN(valor)) {
          const numero = parseFloat(valor);
          if (numero < 5) {
            celula.style.color = "#ff4c4c";
            celula.style.fontWeight = "bold";
          }
        }
      });
    }

    function carregarDadosAluno(id) {
      const aluno = alunos[id];
      if (aluno) {
        document.querySelector(".nome-aluno").textContent = aluno.nome;
        document.getElementById("fotoAluno").src = aluno.foto;
        document.getElementById("fotoAluno").alt = "Foto de " + aluno.nome;
      }
    }

    carregarTodosOsDados();
  </script>
</body>
</html>
